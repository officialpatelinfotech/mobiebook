<!DOCTYPE html>
<html>

<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#607D8B">
  <link rel="manifest" href="manifest.json">
 <meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-title" content="Add to Home">


<style>
.add-button{
   background: none;
   border: none;
   color:blue;
}

.add-button:hover{
   background: none;
   text-decoration: underline;
   color:blue;
}
.Mred-submit-btns{
  margin-left: 0px;
  color: #fff;
  border-radius: 4px;
  padding: 8px 25px 9px 25px;
  white-space: nowrap;
  transition: 0.3s;
  font-size: 14px;
  display: inline-block;
  font-family: "robotoSlab";
  background: #28a745 0% 0% no-repeat padding-box;
  box-shadow: 0px 3px 6px #00000029;
  border-radius: 4px;
  border: none;
  position: relative;
  /* bottom: -18px; */
  cursor: pointer !important;
}
</style>

</head>

<body>

  <div style="width: 100%; height: 100%;" id="frame">

  </div>
  <div style="position: fixed;
    width: 100%;
    bottom: 0px;
    border: 1px solid #eeefec;
    background: white;
    /* height: 40px; */
    z-index: 99999999;
    left: 0;
    vertical-align: middle;
    padding: 2px; display: none;" id="install-div">
	<div style="float: left; padding-top: 3px; padding-right: 10px;">
		<img id="logo" style="width:40px" />
	</div>
	<div style="float: left; padding-top: 8px;">
	<button class="Mred-submit-btns add-button"> Add <span id="btnContent"></span> to home screen</button>
	</div>
	<div style="clear:both"></div>
	</div>
  
  
  <script>
  let deferredPrompt;
const addBtn = document.querySelector('.add-button');
//addBtn.style.display = 'none';


const divVisible = document.getElementById('install-div');

 
window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent Chrome 67 and earlier from automatically showing the prompt
  e.preventDefault();
  // Stash the event so it can be triggered later on the button event.
  deferredPrompt = e;
// Update UI by showing a button to notify the user they can add to home screen
 // addBtn.style.display = 'block';
  divVisible.style.display = 'block';
});
 
//button click event to show the promt
addBtn.addEventListener('click', (e) => {
  // hide our user interface that shows our button
  //addBtn.style.display = 'none';
  divVisible.style.display = 'none';
  // Show the prompt
  deferredPrompt.prompt();
  // Wait for the user to respond to the prompt
  deferredPrompt.userChoice
    .then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the prompt');
      } else {
        console.log('User dismissed the prompt');
      }
      deferredPrompt = null;
    });
});


    if ('serviceWorker' in navigator) {
      // console.log(localStorage.getItem('customer_studio_id'));
      window.addEventListener('load', function () {
        let url = window.location.href.split('?');
        if (url.length > 0) {
          let uniqIdSp = url[url.length - 1];
          let mainUrl = url[url.length - 2];

          let uniqId = uniqIdSp.split('=');
          let idDetail = uniqId[uniqId.length - 1];

          let ids = mainUrl.split('/');
          let folderId = ids[ids.length - 2];
          let mainfolderId = ids[ids.length - 3];

          var a = 'https://api.mobiebook.online/resources/' + mainfolderId + "/" + folderId + '/sw.js'
          navigator.serviceWorker.register(a).then(function (registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function (err) {
            // registration failed :(
            console.log('ServiceWorker registration failed: ', err);
          }).catch(function (err) {
            console.log(err)
          });
        }
      });

    } else {
      console.log('service worker is not supported');
    }

    function load_home() {
      let url = window.location.href.split('?');
      if (url.length > 0) {
        let uniqIdSp = url[url.length - 1];
        let mainUrl = url[url.length - 2];

        let uniqId = uniqIdSp.split('=');
        let idDetail = uniqId[uniqId.length - 1];

        let ids = mainUrl.split('/');
        let folderId = ids[ids.length - 2];
        let mainfolderId = ids[ids.length - 3];

        var iframe = document.createElement('iframe');
        iframe.setAttribute("style", "position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;");
        iframe.src = "https://mobiebook.online/#/ealbum/validate/" + folderId + "/" + idDetail;

        // div tag in which iframe will be added should have id attribute with value myDIV
        document.getElementById("frame").appendChild(iframe);

      }
    }

    load_home();

    function loadJSON(callback) {
      var xObj = new XMLHttpRequest();
      xObj.overrideMimeType("application/json");
      xObj.open('GET', 'manifest.json', true);
      // 1. replace './data.json' with the local path of your file
      xObj.onreadystatechange = function () {
        if (xObj.readyState === 4 && xObj.status === 200) {
          // 2. call your callback function
          callback(xObj.responseText);
        }
      };
      xObj.send(null);
    }

    function init() {
      loadJSON(function (response) {
        // 3. parse JSON string into JSON Object
        console.log('response =', response);
        var json = JSON.parse(response);
        document.title = json.name;
		
		// let bntxt = document.getElementById("btnContent");
		// btnContent.innerHTML  =json.name;
		if(json.icons.length > 0){
			let logo = json.icons[0].src;
			let img = document.getElementById('logo');
			img.src = logo;
		}
        // 4. render to your page

      });
    }

    init();

	

<!-- setTimeout(function(){  -->
	<!-- addBtn.click(); -->
<!-- }, 3000); -->


  </script>
</body>

</html>