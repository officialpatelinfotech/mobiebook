<!DOCTYPE html>
<html>

<head>
  <title>Multi-app PWA demo</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#607D8B">
  <link rel="manifest" href="manifest.json">

</head>

<body>

  <div style="width: 100%; height: 100%;" id="frame">

  </div>
  <script>
    // if ('serviceWorker' in navigator) {
    //   navigator.serviceWorker.register('https://api.mobiebook.online/Resources/statichtml/sw.js', { scope: '/' }).then(function (registration) {
    //     console.log('Service worker registration succeeded:', registration);
    //   }).catch(function (error) {
    //     console.log('Service worker registration failed:', error);
    //   });
    // } else {
    //   console.log('Service workers are not supported.');
    // }
    function loadServiceWorker(userid, albumid) {
      if ('serviceWorker' in navigator) {
        // console.log(localStorage.getItem('customer_studio_id'));
        window.addEventListener('load', function () {
          // navigator.serviceWorker.register('manifests/'+localStorage.getItem('customer_studio_id')+'/service-worker.js').then(function(registration) {
          // navigator.serviceWorker.register('service-worker.js').then(function(registration) {
          console.log('aaa');
          var a = 'https://api.mobiebook.online/Resources/' + userid + '/' + albumid + '/sw.js'
          navigator.serviceWorker.register(a).then(function (registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function (err) {
            // registration failed :(
            console.log('ServiceWorker registration failed: ', err);
          }).catch(function (err) {
            console.log(err)
          });
        });
      }
    }

    function load_home() {
      debugger;


      let url = window.location.href.split('?');
      if (url.length > 0) {
        let uniqIdSp = url[url.length - 1];
        let mainUrl = url[url.length - 2];

        let uniqId = uniqIdSp.split('=');
        let idDetail = uniqId[uniqId.length - 1];

        let ids = mainUrl.split('/');
        let folderId = ids[ids.length - 2];
        let albumId = ids[ids.length - 3];

        var iframe = document.createElement('iframe');
        iframe.setAttribute("style", "position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;");
        iframe.src = "https://mobiebook.online/#/ealbum/validate/" + folderId + "/" + idDetail;

        // div tag in which iframe will be added should have id attribute with value myDIV
        document.getElementById("frame").appendChild(iframe);

        loadServiceWorker(albumId,folderId);
        // provide height and width to it1
        // iframe.contentWindow.document.open();
        // iframe.contentWindow.document.write("https://mobiebook.online/#/ealbum/validate/" + folderId + "/" + idDetail);
        // iframe.contentWindow.document.close();                                              
      }
    }

    load_home();

    

  </script>
</body>

</html>